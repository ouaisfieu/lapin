<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Digicode Psyché Maximal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg1: #05001a;
      --bg2: #120024;
      --accent: #ff00ff;
      --accent2: #00e5ff;
      --accent3: #ffe600;
      --accent4: #ff3366;
      --text: #f7f7ff;
      --danger: #ff3366;
      --success: #47ffb2;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(255, 0, 255, 0.5), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(0, 229, 255, 0.5), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 8px; /* un peu moins de marge pour gagner de la place */
      overflow-x: hidden;
      position: relative;
      animation: bg-shift 16s infinite alternate ease-in-out;
    }

    /* bruit / scanlines de fond */
    body::before {
      content: "";
      pointer-events: none;
      position: fixed;
      inset: -20px;
      background-image:
        linear-gradient(rgba(255,255,255,0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 100% 2px, 2px 100%;
      mix-blend-mode: soft-light;
      opacity: 0.35;
      animation: noise-move 0.8s infinite linear;
      z-index: 0;
    }

    @keyframes bg-shift {
      0% {
        filter: hue-rotate(0deg);
        background-position: 0% 0%, 100% 100%, 0 0;
      }
      100% {
        filter: hue-rotate(40deg);
        background-position: 20% 20%, 80% 80%, 100% 100%;
      }
    }

    @keyframes noise-move {
      0% { transform: translate3d(0,0,0); opacity: 0.3; }
      50% { transform: translate3d(-10px, 6px,0); opacity: 0.45; }
      100% { transform: translate3d(6px,-8px,0); opacity: 0.3; }
    }

    .app {
      width: 100%;
      max-width: 1100px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      z-index: 2;
    }

    @media (min-width: 820px) {
      .app {
        flex-direction: row;
        gap: 12px;
      }
    }

    /* MODE PLEIN ÉCRAN VISIONNEUSE (NOUVEAU) */
    .app.viewer-full .digicode-panel {
      display: none;
    }

    .app.viewer-full .viewer-panel {
      flex: 1 1 auto;
    }

    .app.viewer-full .viewer {
      min-height: 80vh;
    }

    /* BOOT SCREEN (plein écran au chargement) */

    .boot-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 50% 0%, #ff00ff 0, transparent 60%),
                  radial-gradient(circle at 0 100%, #00e5ff 0, transparent 55%),
                  #020008;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 999;
      color: var(--text);
      overflow: hidden;
    }

    .boot-inner {
      text-align: center;
      max-width: 280px;
      padding: 24px;
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.25);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.15), transparent 60%),
                  rgba(5,0,20,0.85);
      box-shadow: 0 24px 60px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    .boot-inner::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        conic-gradient(from 0deg, rgba(255,0,255,0.25), rgba(0,229,255,0.25), rgba(255,230,0,0.25), rgba(255,0,255,0.25));
      mix-blend-mode: screen;
      opacity: 0.3;
      animation: boot-spin 5s linear infinite;
    }

    @keyframes boot-spin {
      to { transform: rotate(360deg); }
    }

    .boot-title {
      position: relative;
      font-size: 1rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 8px;
      text-shadow: 0 0 12px rgba(255,255,255,0.6);
    }

    .boot-sub {
      position: relative;
      font-size: 0.75rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 16px;
    }

    .boot-bar {
      position: relative;
      height: 3px;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
      margin-bottom: 12px;
    }

    .boot-bar::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, var(--accent2), var(--accent3), transparent);
      animation: boot-scan 1.4s infinite;
    }

    @keyframes boot-scan {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .boot-status {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      opacity: 0.8;
    }

    .boot-hint {
      margin-top: 12px;
      font-size: 0.65rem;
      opacity: 0.7;
    }

    .boot-hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease;
    }

    /* PANELS */

    .panel {
      background: linear-gradient(145deg, rgba(10,10,30,0.96), rgba(5,0,40,0.9));
      border-radius: 24px;
      padding: 16px;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.65);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(12px);
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(255, 0, 255, 0.2), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(0, 255, 200, 0.15), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.5;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .title {
      font-size: 1.2rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent2);
      text-shadow: 0 0 8px rgba(0, 229, 255, 0.9);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title span.code-name {
      font-size: 0.8rem;
      text-transform: none;
      color: rgba(255, 255, 255, 0.85);
      letter-spacing: 0.05em;
    }

    .subtitle {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.7);
      max-width: 320px;
    }

    /* Glitch text (petit effet random) */
    .glitch {
      position: relative;
      display: inline-block;
    }

    .glitch::before,
    .glitch::after {
      content: attr(data-text);
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      overflow: hidden;
      clip-path: inset(0 0 0 0);
      opacity: 0.9;
      mix-blend-mode: screen;
    }

    .glitch::before {
      color: var(--accent);
      transform: translate3d(-1px, 0, 0);
      animation: glitch-1 1.4s infinite linear alternate-reverse;
    }

    .glitch::after {
      color: var(--accent2);
      transform: translate3d(1px, 0, 0);
      animation: glitch-2 1.2s infinite linear alternate-reverse;
    }

    @keyframes glitch-1 {
      0% { clip-path: inset(0 0 80% 0); }
      50% { clip-path: inset(10% 0 10% 0); }
      100% { clip-path: inset(80% 0 0 0); }
    }

    @keyframes glitch-2 {
      0% { clip-path: inset(80% 0 0 0); }
      50% { clip-path: inset(15% 0 20% 0); }
      100% { clip-path: inset(0 0 80% 0); }
    }

    .digicode {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .code-display-wrapper {
      border-radius: 16px;
      padding: 10px 12px;
      background: radial-gradient(circle at 0 0, rgba(255, 0, 255, 0.28), transparent 60%);
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.7),
                  0 0 32px rgba(0, 229, 255, 0.8);
      position: relative;
      overflow: hidden;
    }

    .code-display-wrapper::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: repeating-linear-gradient(
        0deg,
        rgba(255,255,255,0.12),
        rgba(255,255,255,0.12) 1px,
        transparent 1px,
        transparent 3px
      );
      mix-blend-mode: soft-light;
      opacity: 0.18;
      pointer-events: none;
      animation: scanline-tilt 3s linear infinite;
    }

    @keyframes scanline-tilt {
      from { transform: translateY(0); }
      to { transform: translateY(-40px); }
    }

    .code-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 6px;
    }

    .rules-hint {
      font-size: 0.65rem;
      opacity: 0.8;
    }

    .code-display {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .digit-slots {
      display: flex;
      gap: 10px;
    }

    .digit-slot {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: var(--accent3);
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.25), transparent 60%),
        linear-gradient(135deg, rgba(40,40,80,0.94), rgba(10,5,40,0.98));
      box-shadow: 0 0 10px rgba(255, 230, 0, 0.6);
      text-shadow: 0 0 8px rgba(255, 230, 0, 0.9);
      transform-origin: center;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .digit-slot:not(.empty) {
      animation: digit-beat 0.5s ease;
    }

    @keyframes digit-beat {
      0% { transform: scale(1); }
      40% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .digit-slot.empty {
      color: rgba(255, 255, 255, 0.18);
      box-shadow: none;
      border-style: dashed;
      text-shadow: none;
    }

    .code-status {
      font-size: 0.7rem;
      text-align: right;
      min-height: 20px;
    }

    .code-status.ok {
      color: var(--success);
      text-shadow: 0 0 12px rgba(71, 255, 178, 0.9);
    }

    .code-status.error {
      color: var(--danger);
      text-shadow: 0 0 10px rgba(255, 51, 102, 0.8);
    }

    .hint-text {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 4px;
    }

    .hint-text strong {
      color: var(--accent3);
    }

    /* KEYPAD */

    .keypad-wrap {
      perspective: 800px;
    }

    .keypad {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
      transform: rotateX(7deg);
      transform-origin: top;
      animation: kb-wobble 5s infinite ease-in-out alternate;
    }

    @keyframes kb-wobble {
      0% { transform: rotateX(7deg) rotateY(-3deg); }
      100% { transform: rotateX(10deg) rotateY(3deg); }
    }

    .key {
      border-radius: 12px;
      padding: 13px 0;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.2), transparent 60%),
        linear-gradient(135deg, rgba(40,40,80,1), rgba(20,10,60,1));
      color: #fff;
      font-size: 1.1rem;
      font-weight: 500;
      text-align: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 0.07s ease, box-shadow 0.07s ease, border-color 0.07s ease, background 0.15s ease;
      box-shadow: 0 12px 24px rgba(0,0,0,0.8);
    }

    .key::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        conic-gradient(from 0deg, rgba(255,0,255,0.5), rgba(0,229,255,0.5), rgba(255,230,0,0.5), rgba(255,0,255,0.5));
      opacity: 0;
      mix-blend-mode: screen;
      transition: opacity 0.15s ease;
    }

    .key:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 6px 12px rgba(0,0,0,0.9);
      border-color: rgba(255,255,255,0.7);
      background:
        radial-gradient(circle at 80% 0%, rgba(255,255,255,0.3), transparent 50%),
        linear-gradient(145deg, rgba(30,30,70,1), rgba(15,5,45,1));
    }

    .key:active::before {
      opacity: 0.9;
    }

    .key.function {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .key.ok {
      border-color: var(--accent2);
      color: var(--accent2);
      text-shadow: 0 0 10px rgba(0,229,255,0.95);
    }

    .key.alt {
      border-color: var(--danger);
      color: var(--danger);
      text-shadow: 0 0 10px rgba(255,51,102,0.95);
    }

    .key.zero {
      grid-column: 2;
    }

    .actions-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-open {
      flex: 1;
      border-radius: 999px;
      padding: 9px 14px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      background: linear-gradient(135deg, rgba(0, 229, 255, 0.28), rgba(255, 0, 255, 0.3));
      color: #fff;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      cursor: pointer;
      text-align: center;
      min-width: 160px;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.2s ease, border-color 0.15s ease;
    }

    .btn-open[disabled] {
      opacity: 0.3;
      cursor: default;
      box-shadow: none;
    }

    .btn-open:not([disabled]):hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.9);
      border-color: rgba(255,255,255,0.7);
    }

    .btn-open-icon {
      font-size: 1rem;
    }

    .current-url {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.85);
      word-break: break-all;
      max-width: 100%;
    }

    .rules-line {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.68);
      margin-top: 4px;
    }

    .rules-line em {
      color: var(--accent3);
    }

    /* VISIONNEUSE */

    .viewer {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 60vh; /* plus haut pour que le site ne paraisse pas rikiki */
    }

    @media (min-width: 820px) {
      .panel.digicode-panel {
        flex: 0 0 38%;
      }
      .panel.viewer-panel {
        flex: 1;
      }
      .viewer {
        min-height: 70vh;
      }
    }

    .viewer-frame {
      flex: 1;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.22);
      box-shadow: 0 18px 42px rgba(0, 0, 0, 0.9);
      position: relative;
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,0.12), transparent 55%),
        linear-gradient(145deg, #060417, #03000e);
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
    }

    .viewer-overlay,
    .viewer-loading {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: rgba(255,255,255,0.8);
      padding: 12px;
      font-size: 0.8rem;
      pointer-events: none;
    }

    .viewer-overlay {
      background:
        radial-gradient(circle at 50% 0%, rgba(0,229,255,0.12), transparent 55%),
        radial-gradient(circle at 0 100%, rgba(255,0,255,0.12), transparent 55%);
    }

    .viewer-overlay span.big {
      font-size: 0.9rem;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--accent2);
      text-shadow: 0 0 10px rgba(0,229,255,0.8);
    }

    .viewer-loading {
      background:
        radial-gradient(circle at 50% 50%, rgba(0,0,0,0.45), rgba(0,0,0,0.9));
      backdrop-filter: blur(4px);
    }

    .viewer-loading-spinner {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.2);
      border-top-color: var(--accent2);
      border-right-color: var(--accent);
      animation: spin 0.8s linear infinite, glow-pulse 1.4s ease-in-out infinite;
      margin-bottom: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes glow-pulse {
      0% { box-shadow: 0 0 8px rgba(0,229,255,0.6); }
      50% { box-shadow: 0 0 22px rgba(255,0,255,0.9); }
      100% { box-shadow: 0 0 8px rgba(0,229,255,0.6); }
    }

    .viewer-loading-text-main {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 4px;
      color: var(--accent3);
    }

    .viewer-loading-text-sub {
      font-size: 0.7rem;
      opacity: 0.9;
    }

    .viewer-note {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.75);
    }

    /* shake sur erreur code */
    .shake {
      animation: shake 0.22s ease-in-out 0s 2;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      50% { transform: translateX(3px); }
      75% { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }

    /* Bouton fantôme pour le plein écran (NOUVEAU) */
    .btn-ghost {
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px dashed rgba(255,255,255,0.45);
      background: transparent;
      color: rgba(255,255,255,0.8);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost:hover {
      background: rgba(255,255,255,0.05);
    }

  </style>
</head>
<body>
  <!-- ÉCRAN DE CHARGEMENT GLOBAL -->
  <div class="boot-screen" id="bootScreen">
    <div class="boot-inner">
      <div class="boot-title glitch" data-text="PORTAIL">&lt;PORTAIL&gt;</div>
      <div class="boot-sub">
        Initialisation du digicode psychédélique.<br/>
        Synchronisation avec la dystopie en cours…
      </div>
      <div class="boot-bar"></div>
      <div class="boot-status">boot sequence : running</div>
      <div class="boot-hint">Astuce&nbsp;: plus tu crois que tu comprends, plus le système se marre.</div>
    </div>
  </div>

  <div class="app" id="appRoot">
    <!-- PANEL DIGICODE -->
    <section class="panel digicode-panel">
      <div class="panel-inner">
        <header class="panel-header">
          <div class="title">
            <span class="glitch" data-text="DIGICODE">DIGICODE</span>
            <span class="code-name">instance&nbsp;: <span style="color:var(--accent3)">#psy-max</span></span>
          </div>
          <div class="subtitle">
            Tape un code à 4 chiffres pour ouvrir un portail.  
            S’il n’existe pas, on t’envoie gentiment vers <strong>mouse-dun</strong>.
          </div>
        </header>

        <div class="digicode">
          <div class="code-display-wrapper" id="codeDisplayWrapper">
            <div class="code-label-row">
              <div>Code d’accès (4 chiffres)</div>
              <div class="rules-hint">Règle d’or&nbsp;: <em>t’as rien compris</em>.</div>
              
            </div>
            <div class="code-display">
              <div class="digit-slots" id="digitSlots">
                <div class="digit-slot empty">•</div>
                <div class="digit-slot empty">•</div>
                <div class="digit-slot empty">•</div>
                <div class="digit-slot empty">•</div>
              </div>
              <div class="code-status" id="codeStatus"></div>
            </div>
            <p class="hint-text">
              Les codes sont câblés dans le code source.  
              Tout le reste tombe dans <strong>https://mouse-dun.vercel.app/</strong>.
            </p>
          </div>

          <div class="keypad-wrap">
            <div class="keypad" id="keypad">
              <button class="key" data-key="1">1</button>
              <button class="key" data-key="2">2</button>
              <button class="key" data-key="3">3</button>

              <button class="key" data-key="4">4</button>
              <button class="key" data-key="5">5</button>
              <button class="key" data-key="6">6</button>

              <button class="key" data-key="7">7</button>
              <button class="key" data-key="8">8</button>
              <button class="key" data-key="9">9</button>

              <button class="key function alt" data-action="clear">Reset</button>
              <button class="key zero" data-key="0">0</button>
              <button class="key function ok" data-action="submit">OK</button>
            </div>
          </div>

          <div class="actions-row">
            <button class="btn-open" id="openNewTabBtn" disabled>
              <span class="btn-open-icon">⧉</span>
              <span>Ouvrir dans un nouvel onglet</span>
            </button>
            <div class="current-url">
              Cible&nbsp;: <span id="currentUrlText">aucune (en attente de code)</span>
            </div>
          </div>

          <div class="rules-line">
            <strong>Règles officielles&nbsp;:</strong>
            <br>1. On ne parle jamais des règles.
            <br>2. Il n’y a pas de règle.
            <br>3. On s’en fout pas mal.
            <br>Indice sur la règle d’or&nbsp;: <em>t’as <a href="spyleaks.html" >rien</a> compris</em>.
            <br>Règle de bronze&nbsp;: <a href="https://ouaisfieu.github.io/boot/play/index.html" >CLIQUE ICI</a>.
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL VISIONNEUSE -->
    <section class="panel viewer-panel">
      <div class="panel-inner">
        <header class="panel-header">
          <div class="title">
            <span class="glitch" data-text="VISIONNEUSE">VISIONNEUSE</span>
            <span class="code-name">mode&nbsp;: <span style="color:var(--accent2)">web-portal</span></span>
          </div>
          <div class="subtitle">
            Affiche le site associé au code, ou le <strong>fallback</strong> si le code
            est imaginaire comme la notion de contrôle.
          </div>
          <button class="btn-ghost" id="toggleViewerSize">
            <span>⤢ PLEIN ÉCRAN</span>
          </button>
        </header>

        <div class="viewer">
          <div class="viewer-frame">
            <iframe id="siteFrame" src="about:blank" loading="lazy" title="Visionneuse de site web"></iframe>

            <!-- État initial -->
            <div class="viewer-overlay" id="viewerOverlay">
              <span class="big">&lt;vide&gt;vide&lt;/vide&gt;</span>
              <span class="sub">
                En attente d’un code à 4 chiffres.<br />
                Spoiler&nbsp;: les portails ne mènent jamais là où tu crois.
              </span>
            </div>

            <!-- Loader par portail -->
            <div class="viewer-loading" id="viewerLoading" style="display:none;">
              <div class="viewer-loading-spinner"></div>
              <div class="viewer-loading-text-main" id="loadingMain">
                DÉCRYPTAGE EN COURS…
              </div>
              <div class="viewer-loading-text-sub" id="loadingSub">
                injection du site choisi dans la matrice perceptive…
              </div>
            </div>
          </div>
          <div class="viewer-note">
            Note&nbsp;: certains sites refusent l’iframe (sécurité navigateur) ou gèrent mal le zoom.  
            Dans ce cas, utilise le bouton <strong>«&nbsp;Ouvrir dans un nouvel onglet&nbsp;»</strong>
            ou le mode <strong>«&nbsp;Plein écran&nbsp;»</strong>.
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ==========================
    // CONFIG : CODES → URLS
    // ==========================
    const CODE_MAP = {
      "0000": "https://ouaisfieu.github.io/",
      "0001": "https://ouaisfieu.github.io/tech/",
      "0002": "https://ouaisfieu.github.io/boot/play/index.html",
      "0007": "https://dl.ouaisfi.eu/1160/",
      "3615": "/vrac/minitel.html",
      "1234": "https://valeurs.vercel.app/",
      "1337": "https://rg-ashy.vercel.app/",
      "1984": "https://ouaisfieu.github.io/bxl2030",
      "4242": "https://mouse-dun.vercel.app/",
      "9999": "https://b-b-ashy.vercel.app/",
      "9998": "https://shop-dusky-theta.vercel.app/",
      "9997": "https://nyxo-beta.vercel.app/2",
      "9996": "https://wire-ebon.vercel.app/",
      "9995": "https://ouaisfieu.github.io/metaFox/",
      "9994": "https://ouaisfieu.github.io/mikey/2/4/2/",
      "9993": "https://ouaisfieu.github.io/shop/",
      "9992": "https://ouaisfieu.github.io/ghostnet/2/",
      "9991": "https://rg-ashy.vercel.app/police.html",
      "9990": "https://yps-sooty.vercel.app/",
      "9989": "https://dl.ouaisfi.eu/jeu/",
      "9988": "https://dl.ouaisfi.eu/noob/",
      "9987": "https://dl.ouaisfi.eu/shop/hops/",
      "9986": "https://rg-ashy.vercel.app/politika.html",
      "9985": "https://rg-ashy.vercel.app/bug.html",
      "9984": "https://rg-ashy.vercel.app/gr",
      "9983": "https://ouaisfieu.github.io/ghostnet/2/",
      "9982": "https://dl.ouaisfi.eu/vrac/kinder.html",
      "9981": "/vrac/test.html",
      "9980": "/vrac/frapad.html",
      "9979": "/vrac/titus.html",
      "9978": "/vrac/luka.html",
      "9977": "/vrac/nostrazola.html",
      "9976": "/vrac/stark.html",
      "9975": "/vrac/hardcore.html",
      "9974": "/vrac/doc.html",
      "9973": "/vrac/baidu-2.html",
      "9972": "/vrac/vomir.html",
      "9971": "/vrac/jouer.html",
      "9970": "/vrac/monitor.html",



      "2000": "/vrac/bacterus.html",
      "2001": "/vrac/didacticiel.html",
      "2002": "/vrac/fiche-de-perso.html",
      "2003": "/vrac/safran.html",
      "2004": "/vrac/case-0.html",
      "2005": "/vrac/metafox.html",
      "2006": "/vrac/looze.html",
      "2007": "/vrac/campagne-clones.html",
      "2008": "/vrac/hub-arcades.html",
      "2009": "/vrac/etageres.html",

      "2010": "/vrac/belgilikjes.html",      
      "2011": "/vrac/tu-raques-ou-pas.html",
      "2012": "/vrac/cyberpunk.html",
      "2013": "/vrac/clooney.html",
      "2014": "/vrac/mr-campagne.html",
      "2015": "/vrac/mr-campagnes.html",
      "2016": "/vrac/jeux-arcade-mr.html",
      "2017": "/vrac/ccplc.html",
      "2018": "/vrac/jeux-arcades.html",
      "2019": "/vrac/titus.html",

      "2020": "/vrac/nyxo.html",
      "2021": "/vrac/xyno.html",
      "2022": "/vrac/cryptoufi.html",
      "2023": "/vrac/onyx.html",
      "2024": "/vrac/nakio.html",
      "2025": "/vrac/cosia.html",
      "2026": "/vrac/funkytown-prod.html",
      "2027": "/vrac/funky.html",
      "2028": "/vrac/bootix.html",
      "2029": "/vrac/minitel-boot-map.html",

      "2030": "/vrac/bande-annonce-claude.html",
      "2031": "/vrac/annonce.html",
      
      
      
      
      
      
    };

    const DEFAULT_URL = "https://mouse-dun.vercel.app/";

    // ==========================
    // STATE
    // ==========================
    let currentCode = "";
    let currentUrl = null;

    // DOM
    const digitSlots = Array.from(document.querySelectorAll(".digit-slot"));
    const codeStatus = document.getElementById("codeStatus");
    const codeDisplayWrapper = document.getElementById("codeDisplayWrapper");
    const openNewTabBtn = document.getElementById("openNewTabBtn");
    const currentUrlText = document.getElementById("currentUrlText");
    const siteFrame = document.getElementById("siteFrame");
    const viewerOverlay = document.getElementById("viewerOverlay");
    const viewerLoading = document.getElementById("viewerLoading");
    const loadingMain = document.getElementById("loadingMain");
    const loadingSub = document.getElementById("loadingSub");
    const bootScreen = document.getElementById("bootScreen");
    const appRoot = document.getElementById("appRoot");
    const toggleViewerSize = document.getElementById("toggleViewerSize");

    // Messages de loading
    const LOADING_MESSAGES = [
      {
        main: "CALIBRAGE DU RÉEL…",
        sub: "alignement des illusions collectives sur le protocole en vigueur…"
      },
      {
        main: "DÉCRYPTAGE DU PORTAIL…",
        sub: "les pixels se concertent pour savoir qui tu crois être…"
      },
      {
        main: "NÉGOCIATION AVEC LE SERVEUR…",
        sub: "tentative de convaincre la réalité d’être coopérative…"
      },
      {
        main: "SYNCHRO AVEC LA DYSTOPIE…",
        sub: "mise à jour des limitations de ta liberté perçue…"
      },
      {
        main: "INJECTION DE CONTENU…",
        sub: "merci de patienter, le vide se remplit de choses discutables…"
      }
    ];

    // ==========================
    // UTILITAIRES
    // ==========================
    function updateDigitSlots() {
      const digits = currentCode.split("");
      digitSlots.forEach((slot, index) => {
        const d = digits[index];
        if (d !== undefined) {
          slot.textContent = d;
          slot.classList.remove("empty");
        } else {
          slot.textContent = "•";
          slot.classList.add("empty");
        }
      });
    }

    function setStatus(message, type) {
      codeStatus.textContent = message || "";
      codeStatus.classList.remove("ok", "error");
      if (type === "ok") codeStatus.classList.add("ok");
      if (type === "error") codeStatus.classList.add("error");
    }

    function pickLoadingMessage(isFallback) {
      const msg = LOADING_MESSAGES[Math.floor(Math.random() * LOADING_MESSAGES.length)];
      loadingMain.textContent = msg.main;
      loadingSub.textContent = msg.sub + (isFallback ? " (code inconnu → fallback)." : "");
    }

    function showViewerLoading(isFallback) {
      pickLoadingMessage(isFallback);
      viewerLoading.style.display = "flex";
      viewerOverlay.style.display = "none";
      openNewTabBtn.disabled = true;
    }

    function hideViewerLoading() {
      viewerLoading.style.display = "none";
      openNewTabBtn.disabled = !currentUrl;
    }

    function setCurrentUrl(url, isFallback) {
      currentUrl = url;
      currentUrlText.textContent = isFallback
        ? url + " (fallback / code inconnu)"
        : url;
      showViewerLoading(isFallback);
      siteFrame.src = url;
    }

    function clearCode() {
      currentCode = "";
      updateDigitSlots();
      setStatus("", null);
      codeDisplayWrapper.classList.remove("shake");
    }

    function submitCode() {
      if (currentCode.length < 4) {
        codeDisplayWrapper.classList.remove("shake");
        void codeDisplayWrapper.offsetWidth;
        codeDisplayWrapper.classList.add("shake");
        setStatus("Tape d’abord 4 chiffres.", "error");
        return;
      }

      const isKnown = currentCode in CODE_MAP;
      const url = isKnown ? CODE_MAP[currentCode] : DEFAULT_URL;

      if (isKnown) {
        setStatus("Code reconnu → ouverture du portail.", "ok");
      } else {
        setStatus("Code inconnu → redirection vers mouse-dun.", "error");
      }

      setCurrentUrl(url, !isKnown);
    }

    // ==========================
    // EVENTS
    // ==========================
    document.getElementById("keypad").addEventListener("click", (event) => {
      const btn = event.target.closest(".key");
      if (!btn) return;

      const digit = btn.getAttribute("data-key");
      const action = btn.getAttribute("data-action");

      if (digit !== null) {
        if (currentCode.length >= 4) {
          currentCode = digit;
        } else {
          currentCode += digit;
        }
        updateDigitSlots();
        setStatus("", null);

        if (currentCode.length === 4) {
          submitCode();
        }
      } else if (action === "clear") {
        clearCode();
      } else if (action === "submit") {
        submitCode();
      }
    });

    openNewTabBtn.addEventListener("click", () => {
      if (!currentUrl) return;
      window.open(currentUrl, "_blank", "noopener,noreferrer");
    });

    // Bouton plein écran visionneuse
    toggleViewerSize.addEventListener("click", () => {
      appRoot.classList.toggle("viewer-full");
      const full = appRoot.classList.contains("viewer-full");
      toggleViewerSize.innerHTML = full ? "⤡ MODE SPLIT" : "⤢ PLEIN ÉCRAN";
    });

    // Chargement de l'iframe : on cache le loader
    siteFrame.addEventListener("load", () => {
      if (!currentUrl) return;
      hideViewerLoading();
    });

    // Clavier physique : 0-9, Enter, Backspace
    document.addEventListener("keydown", (e) => {
      if (e.key >= "0" && e.key <= "9") {
        if (currentCode.length >= 4) {
          currentCode = e.key;
        } else {
          currentCode += e.key;
        }
        updateDigitSlots();
        setStatus("", null);
        if (currentCode.length === 4) {
          submitCode();
        }
      } else if (e.key === "Backspace") {
        e.preventDefault();
        if (currentCode.length > 0) {
          currentCode = currentCode.slice(0, -1);
          updateDigitSlots();
          setStatus("", null);
        }
      } else if (e.key === "Enter") {
        submitCode();
      }
    });

    // Écran de boot : disparition douce
    window.addEventListener("load", () => {
      setTimeout(() => {
        bootScreen.classList.add("boot-hidden");
        setTimeout(() => {
          bootScreen.style.display = "none";
        }, 700);
      }, 1600);
    });
  </script>
</body>
</html>
















